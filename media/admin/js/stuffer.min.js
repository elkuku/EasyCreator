var sortActions;window.addEvent("domready",function(){var e=new Sortables("#package-from, #package-to",{constrain:false,clone:true,revert:true})});function createFile(e,t){document.id("type1").value=e;document.id("type2").value=t;submitbutton("create_install_file")}function submitStuffer(e,t){t.addClass("ajax_loading16");if(document.id("package-to")==null){submitbutton(e);return}var n=document.id("package-to").getElements("li");var a=new Array;n.each(function(e){a.push(e.id)});document.id("packageElements").value=a.join(",");submitbutton(e)}var ecrStuffer=new Class({cnt_update:0,sortActions:null,init:function(){var e=document.id("actionButtons").getElements("div.display");e.each(function(e){e.setStyle("display","none");e.inject(document.id("actionWindow"))});e[0].setStyle("display","block");e=document.id("actionButtons").getElements("a");e.each(function(e){e.addEvent("mousedown",function(e){Stuffer.setActive(this.get("coords"));document.id("actionButtons").getElements("a").each(function(e,t){e.removeClass("active")});this.addClass("active")})});e[0].addClass("active")},setActive:function(e){document.id("actionWindow").getElements("div.display").each(function(t){var n=e==t.get("title")?"block":"none";t.setStyle("display",n)})},addUpdateServer:function(e,t,n,a){var s=document.id("updateServers");var i="";i+='<label class="inline">'+jgettext("URL")+"</label>"+'<input type="text" name="updateServers[url][]" value="'+t+'" /><br />';i+='<label class="inline">'+jgettext("Name")+"</label>"+'<input type="text" name="updateServers[name][]" value="'+e+'" /><br />';i+='<label class="inline">'+jgettext("Priority")+"</label>"+'<input type="text" name="updateServers[priority][]" value="'+a+'" /><br />';i+='<label class="inline">'+jgettext("Type")+"</label>"+'<input type="text" name="updateServers[type][]" value="'+n+'" /><br />';i+='<br /><span class="btn btn-mini" onclick="this.getParent().dispose();">';i+=jgettext("Delete");i+="</span>";new Element("div",{class:"updateServer"}).set("html",i).inject(s)},newAction:function(e){var t=document.id("sel_actions");var n=document.id("sel_event");var a=t.options[t.selectedIndex].value;var s=n.options[n.selectedIndex].value;t.setStyle("outline","");if(""==a){t.setStyle("outline","1px solid red");return false}e.addClass("ajax_loading16");Stuffer.addAction(a,s,{});e.removeClass("ajax_loading16")},addAction:function(e,t,n){this.cnt_update+=1;t=undefined==t?"":t;n.event=t;var a=document.id("container_actions_"+t);var s="";var i=this.cnt_update;s+='<input type="hidden" name="actions['+t+"]["+i+']" value="'+e+'" />';title=e.charAt(0).toUpperCase();title+=e.substr(1);var o="";if("script"==e&&undefined!=n.script){console.log(n);o=n.script;var l=30;if(o.length>l){o='<span class="hasTip" title="'+o+'">...'+o.substr(o.length-l)+"</span>"}o=' - <code class="scriptName">'+o+"</code>"}var c=this.sortActions;new Request.JSON({async:false,url:ecrAJAXLink+"&controller=stuffer&task=getAction"+"&type="+e+"&options="+JSON.stringify(n)+"&cnt="+this.cnt_update,onComplete:function(e){if(e.status){alert(e.message+e.debug);return false}s+='<div class="actionTitle">'+'<i class="img icon16-move" style="cursor: move;" title="'+jgettext("Move")+'"></i>'+'<i class="img icon16-eye" style="cursor: help;" title="'+jgettext("Show settings")+'"'+" onclick=\"Stuffer.toggleContainer(this, 'tgl_action_"+i+"');\"></i>"+title+o+'<span style="float: right;" class="btn btn-mini" onclick="this.getParent().getParent().dispose();">'+jgettext("Delete")+"</span>"+"</div>";s+='<div id="tgl_action_'+i+'" style="display: none;"><fieldset>'+e.message+"</fieldset></div>";var t=new Element("li",{style:"border: 1px solid silver; padding: 0.4em; margin: 0.2em;"}).set("html",s).inject(a);if(c){c.addItems(t)}}}).send()},initActions:function(e){this.sortActions=new Sortables("#"+e+" UL",{constrain:true,clone:true,revert:true,onStart:function(e){e.setStyle("background","#add8e6")},onComplete:function(e){e.setStyle("background","#fff")}})},toggleContainer:function(e,t){var n="icon16-eye";var a="icon16-eyeclosed";if(e.hasClass(a)){e.removeClass(a);e.addClass(n);e.title=jgettext("Show settings");document.id(t).setStyle("display","none")}else{e.removeClass(n);e.addClass(a);e.title=jgettext("Hide settings");document.id(t).setStyle("display","block")}},loadFilenameDefaults:function(e){e.addClass("ajax_loading16");new Request.JSON({url:ecrAJAXLink+"&controller=stuffer&task=getEcrParams",onComplete:function(t){e.removeClass("ajax_loading16");if(t.status){alert(t.message);return false}var n=JSON.decode(t.message);document.id("custom_name_1").set("value",n.custom_name_1);document.id("custom_name_2").set("value",n.custom_name_2);document.id("custom_name_3").set("value",n.custom_name_3)}}).send()},loadPreset:function(e){new Request.JSON({url:ecrAJAXLink+"&"+document.id("adminForm").toQueryString()+"&controller=stuffer&task=loadPreset",onRequest:function(){e.addClass("ajax_loading16")},onFailure:function(){e.removeClass("ajax_loading16");alert(jgettext("The request failed"))},onComplete:function(t){e.removeClass("ajax_loading16");if(undefined==t)return;if(t.status){alert(t.message);return}var n=JSON.decode(t.data);console.log(n);for(v in n){if("actions"==v){console.log("actions...");console.log(n[v]);$$("#container_action ul").each(function(e){console.log(e);e.empty()});document.id("container_action").getChildren().each(function(e){});for(var a=0;a<n[v].length;a++){var s=JSON.decode(n[v][a]);console.info(s);Stuffer.addAction(s.type,s.event,s)}}else{var i=document.id(v);switch(i.type){case"text":i.value=n[v];break;case"checkbox":i.checked="1"==n[v]?"checked":"";break;case"radio":i.value=n[v];var o=document.id("lbl_"+i.id);if(undefined!=o){o.set("text",n[v])}break;case undefined:i.innerHTML=n[v];break;default:console.log("UNKNOWN: "+i.type)}}}}}).send()},savePreset:function(e){e.addClass("ajax_loading16");new Request({url:ecrAJAXLink+"&controller=stuffer&task=savePreset"+"&"+document.id("adminForm").toQueryString(),onRequest:function(){message.setStyle("color","black");message.className="ajax_loading16";message.innerHTML=jgettext("Creating your package...");result.innerHTML=""},onComplete:function(e){var t=JSON.decode(e);message.innerHTML="";message.className="";document.id("ecrProgressBar").getParent().removeClass("active");if(t.status){message.innerHTML=t.message;message.setStyle("color","red")}else{result.innerHTML=t.message}stopPoll()}}).send()}});var Stuffer=new ecrStuffer;